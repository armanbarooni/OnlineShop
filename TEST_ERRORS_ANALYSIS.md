# ุชุญูู ุฎุทุงูุง ุชุณุชโูุง ฺฉูพุงุฑฺฺฏ (Integration Tests)

## ุฎูุงุตู ูุถุนุช
ุชุณุชโูุง ุจุง ูุดฺฉูุงุช ูุชุนุฏุฏ ููุงุฌู ูุณุชูุฏ ฺฉู ุจู ุณู ุฏุณุชู ุงุตู ุชูุณู ูโุดููุฏ:

---

## โ ุฏุณุชู ุงูู: ุฎุทุงูุง 405 Method Not Allowed (ูุดฺฉู ุฏุฑ Route ูุง)

### 1. ูุดฺฉู Cart Controller
**ุชุนุฏุงุฏ ุชุณุชโูุง ูุงูููู: ~28 ุชุณุช**

**ูุดฺฉู:**
- ุชุณุชโูุง ุงุฒ endpoint: `POST /api/cart/add` ุงุณุชูุงุฏู ูโฺฉููุฏ
- ุงูุง ุฏุฑ `CartController.cs` endpoint ุชุนุฑู ุดุฏู: `POST /api/cart/items` ุงุณุช

**ูุงูโูุง ูุดฺฉูโุฏุงุฑ:**
- `ProductVariantTests.cs`
- `OrderManagementTests.cs`
- `WishlistTests.cs`
- `PaymentTests.cs`
- `UserReturnRequestTests.cs`
- `SavedCartTests.cs`
- `ProductInventoryTests.cs`
- `CompleteShoppingJourneyTests.cs`
- `CouponTests.cs`

**ุฑุงู ุญู:**
```csharp
// Option 1: ุงุถุงูู ฺฉุฑุฏู route ุฌุฏุฏ ุฏุฑ CartController
[HttpPost("add")]
public async Task<ActionResult<Result<CartItemDto>>> AddItem([FromBody] CreateCartItemDto cartItem)
{
    // ููุงู ููุทู ููุฌูุฏ
}

// Option 2: ุชุบุฑ endpoint ุฏุฑ ููู ุชุณุชโูุง ุงุฒ /api/cart/add ุจู /api/cart/items
```

---

### 2. ูุดฺฉู Coupon Controller
**ุชุนุฏุงุฏ ุชุณุชโูุง ูุงูููู: 1 ุชุณุช**

**ูุดฺฉู:**
- ุชุณุช `GetAllCoupons_ShouldReturnList` ุงุฒ endpoint: `GET /api/coupon` ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุงูุง `CouponController.cs` ูฺ GET endpoint ุจุฑุง ุฏุฑุงูุช ูุณุช ฺฉููพูโูุง ูุฏุงุฑุฏ

**ุฑุงู ุญู:**
```csharp
// ุงุถุงูู ฺฉุฑุฏู ุฏุฑ CouponController
[HttpGet]
[Authorize(Roles = "Admin")]
public async Task<IActionResult> GetAllCoupons()
{
    var query = new GetAllCouponsQuery();
    var result = await _mediator.Send(query);
    return Ok(result);
}
```

---

### 3. ูุดฺฉู ProductInventory BulkUpdate
**ุชุนุฏุงุฏ ุชุณุชโูุง ูุงูููู: 1 ุชุณุช**

**ูุดฺฉู:**
- ุชุณุช ุงุฒ endpoint bulk update ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ุงุญุชูุงูุงู ูุฌูุฏ ูุฏุงุฑุฏ ุง route ุงุดุชุจุงู ุงุณุช

---

## โ ุฏุณุชู ุฏูู: ุฎุทุงูุง 401 Unauthorized (ูุดฺฉูุงุช ุงุญุฑุงุฒ ููุช)

**ุชุนุฏุงุฏ ุชุณุชโูุง ูุงูููู: ~40 ุชุณุช**

**ูุดฺฉู ุงุตู:**
ุชูุงู ุชุณุชโูุง ฺฉู ูุงุฒ ุจู authentication ุฏุงุฑูุฏ ููโุชูุงููุฏ ุชูฺฉู ูุนุชุจุฑ ุฏุฑุงูุช ฺฉููุฏ.

**ุฏูุงู ุงุญุชูุงู:**

1. **ูุดฺฉู ุฏุฑ AuthHelper:**
   - `AuthHelper.GetAdminTokenAsync()` ููโุชูุงูุฏ ุจุง ููููุช login/register ฺฉูุฏ
   - ููฺฉู ุงุณุช OTP ุตุญุญ ุฏุฑุงูุช ูุดูุฏ
   - ููฺฉู ุงุณุช TestSmsService ุจู ุฏุฑุณุช ฺฉุงุฑ ูฺฉูุฏ

2. **ูุดฺฉู ุฏุฑ ุชูุธูุงุช JWT:**
   - ุชูฺฉูโูุง ุชููุฏ ุดุฏู ูุนุชุจุฑ ูุณุชูุฏ
   - ุชูุธูุงุช JWT ุฏุฑ ูุญุท ุชุณุช ุตุญุญ ูุณุช

3. **ูุดฺฉู ุฏุฑ Database Seeding:**
   - ฺฉุงุฑุจุฑ Admin ุฏุฑ ุฏุชุงุจุณ ุชุณุช ูุฌูุฏ ูุฏุงุฑุฏ
   - Role ูุง ูุงุฒู ุงุฌุงุฏ ูุดุฏูโุงูุฏ

**ูุงูโูุง ูุดฺฉูโุฏุงุฑ:**
- `ProductComparisonTests.cs` - ููู ุชุณุชโูุง
- `ProductReviewTests.cs` - ููู ุชุณุชโูุง
- `UserReturnRequestTests.cs` - ุงฺฉุซุฑ ุชุณุชโูุง
- `PaymentTests.cs` - ุงฺฉุซุฑ ุชุณุชโูุง
- `OrderManagementTests.cs` - ุงฺฉุซุฑ ุชุณุชโูุง
- `ProductInventoryTests.cs` - ฺูุฏ ุชุณุช
- `CompleteShoppingJourneyTests.cs` - ฺูุฏ ุชุณุช

**ุฑุงู ุญู:**
1. ุจุฑุฑุณ `TestSmsService` ู ุงุทููุงู ุงุฒ ุฐุฎุฑู ุตุญุญ OTP
2. ุจุฑุฑุณ ุชูุธูุงุช JWT ุฏุฑ `appsettings.Testing.json`
3. ุงุถุงูู ฺฉุฑุฏู ฺฉุงุฑุจุฑ Admin ูพุดโูุฑุถ ุฏุฑ `CustomWebApplicationFactory`
4. ุงุณุชูุงุฏู ุงุฒ Mock Authentication ุจุฑุง ุชุณุชโูุง

---

## โ ุฏุณุชู ุณูู: ุฎุทุงูุง 400 Bad Request (ูุดฺฉูุงุช Validation)

**ุชุนุฏุงุฏ ุชุณุชโูุง ูุงูููู: ~5 ุชุณุช**

**ูุดฺฉูุงุช:**

1. **CompleteUserJourney - OTP Request:**
   - ุงุฑุณุงู OTP ุจุง BadRequest ููุงุฌู ูโุดูุฏ
   - ุงุญุชูุงูุงู validation ุง ุชูุธูุงุช SMS ุฏุฑุณุช ูุณุช

2. **ProductSearchFlow - Category Filter:**
   - ุฌุณุชุฌู ุจุง ููุชุฑ category ุจุง BadRequest ููุงุฌู ูโุดูุฏ
   - ุงุญุชูุงูุงู ูพุงุฑุงูุชุฑูุง ุงุฑุณุงู ุตุญุญ ูุณุชูุฏ

3. **CreateCoupon:**
   - ุณุงุฎุช ฺฉููพู ุจุง BadRequest ููุงุฌู ูโุดูุฏ
   - ุงุญุชูุงูุงู validation ูุง DTO ุฑุนุงุช ูุดุฏู

4. **CheckLowStock:**
   - ูพุงุฑุงูุชุฑูุง ุงุฑุณุงู ุตุญุญ ูุณุชูุฏ

---

## ๐ ุขูุงุฑ ฺฉู (ุชุฎูู)

ุงุฒ ุฎุฑูุฌ ุชุณุชโูุง:
- **ุชุนุฏุงุฏ ฺฉู ุชุณุชโูุง:** ~120+ ุชุณุช
- **ุชุณุชโูุง ูุงูููู:** ~75 ุชุณุช (ุญุฏูุฏ 62%)
- **ุชุณุชโูุง ูููู:** ~45 ุชุณุช (ุญุฏูุฏ 38%)

**ุชูุณูโุจูุฏ ุฎุทุงูุง:**
- 405 Method Not Allowed: ~30 ุชุณุช (40%)
- 401 Unauthorized: ~40 ุชุณุช (53%)
- 400 Bad Request: ~5 ุชุณุช (7%)

---

## โ ุฑุงูฺฉุงุฑูุง ูพุดููุงุฏ (ุงูููุชโุจูุฏ ุดุฏู)

### ุงูููุช 1: ุฑูุน ูุดฺฉูุงุช Route (ุชุงุซุฑ ุจุงูุง - ุชูุงุด ฺฉู)
1. ุงุตูุงุญ `CartController` ุจุฑุง ูพุดุชุจุงู ุงุฒ `/api/cart/add`
2. ุงุถุงูู ฺฉุฑุฏู `GetAll` ุจู `CouponController`
3. ุจุฑุฑุณ ู ุงุตูุงุญ route ูุง `ProductInventory`

### ุงูููุช 2: ุฑูุน ูุดฺฉูุงุช Authentication (ุชุงุซุฑ ุจุงูุง - ุชูุงุด ูุชูุณุท)
1. ุงุถุงูู ฺฉุฑุฏู Mock Authentication ุจุฑุง ุชุณุชโูุง
2. ุง ุฑูุน ูุดฺฉูุงุช `AuthHelper` ู `TestSmsService`
3. ุงุทููุงู ุงุฒ ูุฌูุฏ ฺฉุงุฑุจุฑุงู ุชุณุช ุฏุฑ ุฏุชุงุจุณ

### ุงูููุช 3: ุฑูุน ูุดฺฉูุงุช Validation (ุชุงุซุฑ ฺฉู - ุชูุงุด ฺฉู)
1. ุจุฑุฑุณ ู ุงุตูุงุญ DTO ูุง ุงุฑุณุงู ุฏุฑ ุชุณุชโูุง
2. ุงุถุงูู ฺฉุฑุฏู logging ุจุฑุง ุฏุฏู ุฏูู ุฎุทุงูุง validation

---

## ๐ง ฺฏุงูโูุง ุจุนุฏ

1. โ ุดูุงุณุง ูุดฺฉูุงุช (ุงูุฌุงู ุดุฏ)
2. โณ ุงุตูุงุญ Controller ูุง ุจุฑุง route ูุง ููุฑุฏ ุงูุชุธุงุฑ
3. โณ ุฑูุน ูุดฺฉูุงุช Authentication
4. โณ ุงุฌุฑุง ูุฌุฏุฏ ุชุณุชโูุง ู ุจุฑุฑุณ ูุชุงุฌ
5. โณ ุฑูุน ูุดฺฉูุงุช ุจุงููุงูุฏู


