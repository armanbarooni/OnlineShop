<!doctype html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پرداخت ناموفق</title>
    <link rel="stylesheet" href="assets/css/app.css">
</head>
<body class="bg-light dark:bg-zinc-900 text-text-primary-light dark:text-text-primary-dark">
<main class="container py-10">
    <section class="max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8 text-center">
        <h1 class="text-2xl font-bold text-red-600 mb-4">پرداخت ناموفق بود</h1>
        <p id="failText" class="text-gray-600 dark:text-gray-300 mb-6">اگر مبلغ از حساب شما کسر شده، طی ۷۲ ساعت کاری بازگشت داده می‌شود.</p>
        <div class="space-x-2 space-x-reverse">
            <a href="payment.html" class="inline-flex items-center px-5 py-3 rounded-lg bg-primary text-white hover:bg-primary/90">تلاش مجدد</a>
            <a href="user-panel-order.html" class="inline-flex items-center px-5 py-3 rounded-lg bg-gray-200 dark:bg-gray-700 dark:text-white hover:bg-gray-300">مشاهده سفارش‌ها</a>
        </div>
    </section>
    
 </main>

<script src="assets/js/api-client.js"></script>
<script src="assets/js/auth-service.js"></script>
<script src="assets/js/auth-guard.js"></script>
<script src="config.js"></script>
<script src="assets/js/utils.js"></script>
<script src="assets/js/services/payment-service.js"></script>
<script src="assets/js/services/order-service.js"></script>
<script src="assets/js/components/header-component.js"></script>
<script src="assets/js/components/footer-component.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const url = new URL(window.location.href);
        const paymentId = url.searchParams.get('paymentId');
        const orderId = url.searchParams.get('orderId');
        const errorMsg = url.searchParams.get('error');
        const el = document.getElementById('failText');
        try {
            if (errorMsg) {
                el.textContent = decodeURIComponent(errorMsg);
                return;
            }
            if (paymentId) {
                const res = await window.paymentService.getPaymentStatus(paymentId);
                if (res.success && res.data && res.data.status) {
                    el.textContent = 'وضعیت پرداخت: ' + window.paymentService.getPaymentStatusText(res.data.status);
                }
            } else if (orderId) {
                const res = await window.paymentService.getPaymentsByOrderId(orderId);
                if (res.success && Array.isArray(res.data) && res.data.length) {
                    el.textContent = 'آخرین وضعیت پرداخت برای سفارش شما دریافت شد.';
                }
            }
        } catch (e) {
            // keep default text
        }
    });
 </script>

</body>
</html>
