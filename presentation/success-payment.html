<!doctype html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موفقیت پرداخت</title>
    <link rel="stylesheet" href="assets/css/app.css">
</head>
<body class="bg-light dark:bg-zinc-900 text-text-primary-light dark:text-text-primary-dark">
<main class="container py-10">
    <section class="max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8 text-center">
        <h1 class="text-2xl font-bold text-green-600 mb-4">پرداخت با موفقیت انجام شد</h1>
        <p id="statusText" class="text-gray-600 dark:text-gray-300 mb-6">در حال بررسی وضعیت پرداخت...</p>
        <a id="ordersLink" href="user-panel-order.html" class="inline-flex items-center px-5 py-3 rounded-lg bg-primary text-white hover:bg-primary/90">مشاهده سفارش‌ها</a>
    </section>
</main>

<script src="assets/js/api-client.js"></script>
<script src="assets/js/services/payment-service.js"></script>
<script src="assets/js/utils.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const url = new URL(window.location.href);
        const paymentId = url.searchParams.get('paymentId');
        const orderId = url.searchParams.get('orderId');
        const statusEl = document.getElementById('statusText');

        try {
            let result;
            if (paymentId) {
                result = await window.paymentService.getPaymentStatus(paymentId);
            } else if (orderId) {
                const res = await window.paymentService.getPaymentsByOrderId(orderId);
                if (res.success && Array.isArray(res.data) && res.data.length) {
                    result = await window.paymentService.getPaymentStatus(res.data[0].id || res.data[0].paymentId);
                } else {
                    statusEl.textContent = 'سفارش یافت نشد، اما پرداخت ثبت شد.';
                    return;
                }
            }

            if (result && result.success) {
                statusEl.textContent = 'پرداخت تایید شد.';
            } else {
                statusEl.textContent = 'پرداخت ثبت شد، وضعیت نامشخص.';
            }
        } catch (e) {
            statusEl.textContent = 'امکان بازیابی وضعیت پرداخت نبود.';
        }
    });
</script>
</body>
</html>

