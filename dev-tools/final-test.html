<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طھط³طھ ظ†ظ‡ط§غŒغŒ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .step { display: none; padding: 20px; border: 1px solid #ccc; margin: 10px 0; }
        .step.active { display: block; }
    </style>
</head>
<body>
    <h1>طھط³طھ ظ†ظ‡ط§غŒغŒ - ط«ط¨طھ ظ†ط§ظ…</h1>
    
    <div id="step1" class="step active">
        <h2>ظ…ط±ط­ظ„ظ‡ 1: ط§ط·ظ„ط§ط¹ط§طھ ط´ط®طµغŒ</h2>
        <input type="text" id="first-name" placeholder="ظ†ط§ظ…" value="ط¹ظ„غŒ">
        <input type="text" id="last-name" placeholder="ظ†ط§ظ… ط®ط§ظ†ظˆط§ط¯ع¯غŒ" value="ط§ط­ظ…ط¯غŒ">
        <input type="text" id="mobile" placeholder="ط´ظ…ط§ط±ظ‡ ظ…ظˆط¨ط§غŒظ„" value="09123456789">
        <br><br>
        <button onclick="nextStep(1, 2)">ظ…ط±ط­ظ„ظ‡ ط¨ط¹ط¯</button>
    </div>
    
    <div id="step2" class="step">
        <h2>ظ…ط±ط­ظ„ظ‡ 2: ط±ظ…ط² ط¹ط¨ظˆط±</h2>
        <input type="password" id="password" placeholder="ط±ظ…ط² ط¹ط¨ظˆط±" value="123456">
        <input type="password" id="confirm-password" placeholder="طھع©ط±ط§ط± ط±ظ…ط² ط¹ط¨ظˆط±" value="123456">
        <br><br>
        <button onclick="prevStep(2, 1)">ظ…ط±ط­ظ„ظ‡ ظ‚ط¨ظ„</button>
        <button onclick="nextStep(2, 3)">ظ…ط±ط­ظ„ظ‡ ط¨ط¹ط¯</button>
    </div>
    
    <div id="step3" class="step">
        <h2>ظ…ط±ط­ظ„ظ‡ 3: طھط§غŒغŒط¯</h2>
        <p>ط§ط·ظ„ط§ط¹ط§طھ ط´ظ…ط§:</p>
        <div id="user-info"></div>
        <br>
        <button onclick="prevStep(3, 2)">ظ…ط±ط­ظ„ظ‡ ظ‚ط¨ظ„</button>
        <button onclick="submitForm()">ط«ط¨طھ ظ†ط§ظ…</button>
    </div>
    
    <div id="result"></div>

    <script src="config.js"></script>`r`n<script src="assets/js/utils/logger.js"></script>
    <script src="assets/js/api-client.js"></script>
    <script src="assets/js/utils.js"></script>
    <script>
        let currentStep = 1;
        let registrationData = {};

        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        // Step change function
        function nextStep(current, next) {
            console.log(`Moving from step ${current} to step ${next}`);
            
            // Validate current step
            if(current === 1) {
                if (!validateStep1()) {
                    return;
                }
            } else if(current === 2) {
                if (!validateStep2()) {
                    return;
                }
            }

            // Hide current step
            document.getElementById(`step${current}`).classList.remove('active');

            // Show next step
            document.getElementById(`step${next}`).classList.add('active');
            currentStep = next;
            
            // Update user info in step 3
            if(next === 3) {
                updateUserInfo();
            }
        }

        function prevStep(current, prev) {
            console.log(`Moving from step ${current} to step ${prev}`);
            
            // Hide current step
            document.getElementById(`step${current}`).classList.remove('active');

            // Show previous step
            document.getElementById(`step${prev}`).classList.add('active');
            currentStep = prev;
        }

        // Validate step 1 (Personal Info)
        function validateStep1() {
            const firstName = document.getElementById('first-name').value.trim();
            const lastName = document.getElementById('last-name').value.trim();
            const mobile = document.getElementById('mobile').value.trim();

            if(!firstName || !lastName || !mobile) {
                showResult('ظ„ط·ظپط§ طھظ…ط§ظ… ظپغŒظ„ط¯ظ‡ط§غŒ ط§ط¬ط¨ط§ط±غŒ ط±ط§ ظ¾ط± ع©ظ†غŒط¯', 'error');
                return false;
            }

            if(!/^09\d{9}$/.test(mobile)) {
                showResult('ظ„ط·ظپط§ ط´ظ…ط§ط±ظ‡ ظ…ظˆط¨ط§غŒظ„ ظ…ط¹طھط¨ط± ظˆط§ط±ط¯ ع©ظ†غŒط¯', 'error');
                return false;
            }

            // Store data
            registrationData.firstName = firstName;
            registrationData.lastName = lastName;
            registrationData.mobile = mobile;

            showResult('ظ…ط±ط­ظ„ظ‡ 1 طھط§غŒغŒط¯ ط´ط¯', 'success');
            return true;
        }

        // Validate step 2 (Password)
        function validateStep2() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if(!password || !confirmPassword) {
                showResult('ظ„ط·ظپط§ ط±ظ…ط² ط¹ط¨ظˆط± ظˆ طھع©ط±ط§ط± ط¢ظ† ط±ط§ ظˆط§ط±ط¯ ع©ظ†غŒط¯', 'error');
                return false;
            }

            if(password !== confirmPassword) {
                showResult('ط±ظ…ط² ط¹ط¨ظˆط± ظˆ طھع©ط±ط§ط± ط¢ظ† ظ…ط·ط§ط¨ظ‚طھ ظ†ط¯ط§ط±ظ†ط¯', 'error');
                return false;
            }

            // Store data
            registrationData.password = password;

            showResult('ظ…ط±ط­ظ„ظ‡ 2 طھط§غŒغŒط¯ ط´ط¯', 'success');
            return true;
        }

        function updateUserInfo() {
            const userInfoDiv = document.getElementById('user-info');
            userInfoDiv.innerHTML = `
                <p><strong>ظ†ط§ظ…:</strong> ${registrationData.firstName}</p>
                <p><strong>ظ†ط§ظ… ط®ط§ظ†ظˆط§ط¯ع¯غŒ:</strong> ${registrationData.lastName}</p>
                <p><strong>ط´ظ…ط§ط±ظ‡ ظ…ظˆط¨ط§غŒظ„:</strong> ${registrationData.mobile}</p>
            `;
        }

        async function submitForm() {
            showResult('ط¯ط± ط­ط§ظ„ ط«ط¨طھ ظ†ط§ظ…...', 'info');
            
            try {
                // Test API connection first
                const healthResponse = await fetch('https://localhost:7025/api/health');
                
                if (healthResponse.ok) {
                    showResult('âœ… ط§طھطµط§ظ„ ط¨ظ‡ API ظ…ظˆظپظ‚! ط¯ط± ط­ط§ظ„ ط«ط¨طھ ظ†ط§ظ…...', 'success');
                    
                    // Now try registration
                    const response = await fetch('https://localhost:7025/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(registrationData)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        showResult(`âœ… ط«ط¨طھ ظ†ط§ظ… ظ…ظˆظپظ‚!<br>Response: ${JSON.stringify(data)}`, 'success');
                    } else {
                        const errorData = await response.json();
                        showResult(`âڑ ï¸ڈ ط®ط·ط§ ط¯ط± ط«ط¨طھ ظ†ط§ظ…: ${response.status}<br>Message: ${errorData.message || 'Unknown error'}`, 'error');
                    }
                } else {
                    showResult('â‌Œ API ط¯ط± ط¯ط³طھط±ط³ ظ†غŒط³طھ', 'error');
                }
            } catch (error) {
                showResult(`â‌Œ ط®ط·ط§ ط¯ط± ط§طھطµط§ظ„: ${error.message}<br><br><strong>ط±ط§ظ‡ ط­ظ„:</strong> ظ…ط±ظˆط±ع¯ط± ط±ط§ ط¨ط§ CORS ط؛غŒط±ظپط¹ط§ظ„ ط¨ط§ط² ع©ظ†غŒط¯`, 'error');
            }
        }

        // Test if all scripts are loaded
        window.addEventListener('load', function() {
            console.log('Page loaded');
            console.log('Config:', window.config);
            console.log('API Client:', window.apiClient);
            console.log('Utils:', window.utils);
            
            if (window.config && window.apiClient && window.utils) {
                showResult('âœ… ظ‡ظ…ظ‡ ط§ط³ع©ط±غŒظ¾طھâ€Œظ‡ط§ ط¨ط§ ظ…ظˆظپظ‚غŒطھ ظ„ظˆط¯ ط´ط¯ظ†ط¯', 'success');
            } else {
                showResult('â‌Œ ظ…ط´ع©ظ„ ط¯ط± ظ„ظˆط¯ ط§ط³ع©ط±غŒظ¾طھâ€Œظ‡ط§', 'error');
            }
        });
    </script>
</body>
</html>



